# 维信通
## 引入es组件
- 场景：对商家上报的每日营收明细数据进行聚合查询
- 问题：mysql的sql语句需要使用时间处理函数和聚合函数，数据量大时性能不好
> 引入es，验证可行性，搭建demo使用es的高版本聚合查询功能，集成到实际项目，springboot版本低，无法使用高版本es，7版本和6版本的es聚合查询api不兼容，使用基本的查询和组合功能实现聚合查询，推动springboot版本升级
>
> es分页，聚合查询后的数据固定条数，全部查询到内存后，通过手动指定分页参数from和size返回所需数据
>
> es和mysql数据一致性问题，非实时同步，同步增量数据，使用定时任务判断es和mysql的增量数据量是否一致
## 使用多线程综合应用
- 场景：导入商家历史营收数据
- 问题：需要存储excel文件并记录到文件表、解析文件数据并批量记录到业务表、初始化营收数据计算规则并记录到规则表3个步骤，顺序执行，在同一个事务中，比较耗时
> 采用多线程方式，使用completableFuture组合3个异步操作，原子变量AtomicInteger记录任务失败个数，通过cyclicbarrier.await()控制操作同步，在每个线程中使用编程式事务，根据失败个数是否大于0手动提交或回退事务
> 
> 多线程场景下，每个线程使用自己的事务上下文，无法通过声明式事务进行事务管理
> 
> 事务的传播机制是在同一个线程中管理事务的传播，用于一个线程中多个事务方法之间调用
# 艺术升
## 高并发
- 场景：高并发下，考生进入考场获取考试信息
- 问题：数据库负载过高、请求处理延迟
> 使用redis缓存，nginx负载均衡
> 
> 缓存预热，实现CommandLineRunner接口，在启动时将考试信息同步到缓存，或通过定时任务，将考试信息同步到缓存，设置缓存过期时间为一周，采用惰性+定期的方式删除过期key