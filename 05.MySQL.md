# Mysql基础
## MySQL常用函数
- count
- sum
- max
- min
- avg
## 三大范式
- 第一范式：每列都不能再拆分
- 第二范式：在第一范式下，非主键列完全依赖主键列
- 第三范式：在第二范式下，非主键列只依赖主键列
## Innodb和MyISAM的区别
### Innodb
- 支持事务ACID
- 支持行锁
- 支持表锁
- 支持外键
### MyISAM
- 不支持事务
- 不支持行锁
- 支持表锁
- 不支持外键
# 索引
## 索引定义
- 索引是一个文件，包含对数据表中所有记录的引用指针，是一种数据结构，快速查询，常用实现：B+树
## 索引优缺点
### 优点
- 加快查询速度
- 使用优化隐藏器，提高系统性能
### 缺点
- 创建和维护索引需要耗费时间，降低增删改的执行效率
- 需要占用物理空间
## 索引创建方式
- 建表时创建：***,primary key id, unique key idx_u_1(*, *),key idx_n_1(*)
- 新增索引1：alter table table_name add index idx_n_1(*);【可以创建任意索引】
- 新增索引2：create index idx_n_1 on table_name (*);【不能创建主键索引】
## 索引存储方式
- B+树：Innodb默认的存储方式【多路平衡查找树】
- 哈希索引：哈希得到键值->回表查询实际数据【hash表】，只适合等值查询，不支持范围查询
## B树和B+树区别
### B树
- B树的非叶子节点存储key-value
- 重复查询多次的场景
### B+树
- B+树的非叶子节点只存储key
- B+树的叶子节点存储value
- B+树空间利用率高，减少I/O次数，磁盘读一次的key更多
- B+树value按顺序在叶子节点存储，范围查询
- B+树查询性能稳定，都要查到叶子节点
## 聚簇索引和非聚簇索引
### 聚簇索引
- 叶子节点存储当前索引值和整行数据，不用回表
### 非聚簇索引
- 叶子节点存储当前行数据的主键值
- 查询字段如果都命中了索引，则不必回表
## 联合索引
- 多个字段建立一个索引
- 需要按照建立索引的顺序使用字段，才可以命中联合索引
- alter table table_name add index idx_n_1(a, b, c);
- a; a、b; a、b、c;都是索引
# 事务
## 事务定义
- 事务是一个不可分割的数据操作序列
- 数据库并发控制的基本单位
- 事务的执行结果使数据库从一种一致性状态变为另一种一致性状态
- 事务是逻辑上的一组操作，要么都执行，要么都不执行
## 事务特性【ACID】
- A：原子性，事务是最小的执行单位，不可分割，确保动作要么全部完成，要么完全不起作用
- C：一致性，事务执行前后，数据是一致的
- I：隔离性，并发访问数据库时，事务之间不会相互影响，事务之间是独立的
- D：持久性，事务提交后，对数据库中数据的改变是持久的，即使数据库发生障碍也不影响
## 事务隔离级别
- 读未提交：允许读取其他事务未提交的数据变更
- 读已提交：允许读取其他事务提交的数据变更
- 可重复读：对同一行数据多次读取的结果保持一致
- 串行化：事务依次执行
## 脏读、不可重复读、幻读
- 脏读
> 第N行的K字段值为V1，A事务第一次读结果是V1
> B事务将K字段值修改成V2，A事务第二次读到的结果是V2
> B事务将K字段值修改成V3，A事务第三次读到的结果是V3
> B事务将K字段值修改成V4，提交事务，此时K字段值为V4，而A事务读到的结果还是V3
- 不可重复读
> 第N行的K字段值为V1，A事务第一次读结果是V1
> B事务将K字段值修改成V2，提交事务，A事务第二次读到的结果是V2
> B事务将K字段值修改成V3，提交事务，A事务第三次读到的结果是V3
> B事务将K字段值修改成V4，提交事务，A事务第四次读到的结果是V4，每次读到的结果都不一样
- 幻读
> A事务第一次查询，K字段值符合查询条件的结果只有1条
> B事务新增符合查询条件的数据1条，提交事务，A事务第二次查询，K字段值符合查询条件的结果有2条
> B事务新增符合查询条件的数据1条，提交事务，A事务第三次查询，K字段值符合查询条件的结果有3条
> B事务新增符合查询条件的数据1条，提交事务，A事务第四次查询，K字段值符合查询条件的结果有4条，每次查询的结果条数不一样
## Mysql锁
- 表级锁、行级锁
- 记录锁【Record lock】 + 间隙锁【Gap lock】 = 临键锁【Next-key lock】（行锁的三种方式）
- 共享锁【S lock】、排他锁【X lock】
> S lock：读锁，读取记录时获取锁，允许多个事务同时获取

> X lock：写锁，修改记录时获取锁，不允许多个事务同时获取，一条记录已经被加了X锁，其他事务不能再对这条记录加任何锁
# sql优化
- 控制单表数据量大小
- 尽可能所有列定义为NOT NULL【NULL列需要额外空间存储，对NULL列比较和计算要特殊处理】
- 单表索引不超过5个
- 频繁查询字段考虑使用覆盖索引
- 禁止select *【消耗CPU、增加网络宽带消耗、无法使用覆盖索引、表结构修改后的影响】
- 避免字段数据类型的隐式转换导致索引失效
- 避免多张表join关联【关联缓存，临时表】
# MVCC
- MySQL默认的隔离级别是RR，采用MVCC + next-key lock解决幻读问题
# 三大日志
- redolog
> 重做日志，物理日志，崩溃宕机后恢复
- binlog
> 数据备份、主从，保证数据一致性，逻辑日志
- undolog
> 事务回滚，逻辑日志